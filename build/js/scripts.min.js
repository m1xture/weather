const heroRef=document.querySelector(".hero"),changeImgRef=document.querySelector(".header__btn-bg"),imgsArr=["../../img/bg1.jpg","../../img/bg2.jpg","../../img/bg3.jpg"];changeImgRef.addEventListener("click",(()=>{const e=imgsArr.length-1,t=Math.round(Math.random()*(e-0)+0),r=(heroRef.style.backgroundImage,imgsArr[t]);heroRef.style.backgroundImage=`linear-gradient(\n    180deg,\n    rgba(8, 15, 26, 0.59) 0%,\n    rgba(17, 17, 46, 0.46) 100%\n  ), url(${r})`}));let selectedUnits="C";const unitsBtns=document.querySelector(".degrees");unitsBtns.addEventListener("click",(function(e){e.target.hasAttribute("data-f")?(selectedUnits="F",e.target.classList.remove("degrees__disable"),e.target.nextElementSibling.classList.add("degrees__disable")):(selectedUnits="C",e.target.classList.remove("degrees__disable"),e.target.previousElementSibling.classList.add("degrees__disable")),weatherFetch.call(formEl)}));let map=L.map("map").setView([51.505,-.09],7);L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);const weatherElems={cityTextEl:document.querySelector(".location__text"),dayOfWeekEl:document.querySelector("[data-date]"),dayNumEl:document.querySelector("[date-num]"),monthTextEl:document.querySelector("[data-month]"),timeTextEl:document.querySelector("[data-time]"),currentDegree:document.querySelector("[data-degree]"),currentWeatherIcon:document.querySelector(".hero__main-weather-ico"),currentStatus:document.querySelector("[data-current-status]"),feelsLikeEl:document.querySelector("[data-feels-like]"),windEl:document.querySelector("[data-wind]"),humidity:document.querySelector("[data-humidity]"),forecastBlocksRefs:document.querySelectorAll(".forecast-description-block"),firstDay:{firstDayOfWeekEl:document.querySelector("[data-first-day]"),firstDayOfWeekDegreeEl:document.querySelector("[data-first-degree]"),firstDayOfWeekIcon:document.querySelector("[data-first-day-ico]")},secondDay:{secondDayOfWeekEl:document.querySelector("[data-second-day]"),secondDayOfWeekDegreeEl:document.querySelector("[data-second-degree]"),secondDayOfWeekIcon:document.querySelector("[data-second-day-ico]")},thirdDay:{thirdDayOfWeekEl:document.querySelector("[data-third-day]"),thirdDayOfWeekDegreeEl:document.querySelector("[data-third-degree]"),thirdDayOfWeekIcon:document.querySelector("[data-third-day-ico]")}},DateClass=new Date,weekdayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthsNames=["January","February","March","April","May","June","July","August","September","October","November","December"];let mapMarker,mapCircle;const formEl=document.querySelector(".search__form"),errorTextEl=document.querySelector("[data-search-error]");let errors=0;function weatherFetch(){fetch(`https://api.openweathermap.org/data/2.5/weather?q=${this.cityInput.value}&appid=9a6c5b632623b9a0c279060fc1b94b4d`).then((e=>e.json())).then((function(e){console.log(e),weatherElems.cityTextEl.textContent=`${e.name}, ${e.sys.country}`;let t=`${DateClass.getMinutes()}`;DateClass.getMinutes()<10&&(t=`0${DateClass.getMinutes()}`),weatherElems.timeTextEl.textContent=`${DateClass.getHours()}:${t}`,weatherElems.dayOfWeekEl.textContent=`${weekdayNames[DateClass.getDay()]}`,weatherElems.dayNumEl.textContent=`${DateClass.getDate()}`,weatherElems.monthTextEl.textContent=`${monthsNames[DateClass.getMonth()]}`,"F"===selectedUnits&&(weatherElems.currentDegree.textContent=`${Math.round(1.8*(e.main.temp-273)+32)}`),"C"===selectedUnits&&(weatherElems.currentDegree.textContent=`${Math.round(e.main.temp-273)}`),weatherElems.currentStatus.textContent=e.weather[0].description,localStorage.setItem("cityValue",formEl.cityInput.value),"Clear"===e.weather[0].main&&("01d"===e.weather[0].icon?weatherElems.currentWeatherIcon.src="../img/icons/sun.png":"01n"===e.weather[0].icon&&(weatherElems.currentWeatherIcon.src="../img/icons/moon.png")),"Clouds"===e.weather[0].main&&("02d"===e.weather[0].icon?weatherElems.currentWeatherIcon.src="../img/icons/cloudsSunD.png":"02n"===e.weather[0].icon?weatherElems.currentWeatherIcon.src="../img/icons/cloudsMoonN.png":"03d"===e.weather[0].icon?weatherElems.currentWeatherIcon.src="../img/icons/cloudsun.png":"03n"===e.weather[0].icon?weatherElems.currentWeatherIcon.src="../img/icons/cloudmoon.png":"03d"===e.weather[0].icon||"03n"===e.weather[0].icon?weatherElems.currentWeatherIcon.src="../img/icons/twoclouds.png":"04d"!==e.weather[0].icon&&"04n"!==e.weather[0].icon||(weatherElems.currentWeatherIcon.src="../img/icons/twoclouds.png")),"Smoke"===e.weather[0].main||"Haze"===e.weather[0].main||"Dust"===e.weather[0].main||"Fog"===e.weather[0].main||"Sand"===e.weather[0].main||"Ash"===e.weather[0].main||"Squall"===e.weather[0].main||"Tornado"===e.weather[0].main?weatherElems.currentWeatherIcon.src="../img/icons/cloudFog.png":"mist"===e.weather[0].description&&(weatherElems.currentWeatherIcon.src="../img/icons/sunFog.png"),"light snow"===e.weather[0].description||"light shower sleet"===e.weather[0].description||"light rain and snow"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/cloud1snow.png":"snow"===e.weather[0].description||"sleet"===e.weather[0].description||"shower sleet"===e.weather[0].description||"rain and snow"===e.weather[0].description||"shower snow"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/snow.png":"heavy snow"===e.weather[0].description||"heavy shower snow"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/cloudsnow.png":"light shower snow"===e.weather[0].description&&(weatherElems.currentWeatherIcon.src="../img/icons/snows.png"),"Rain"===e.weather[0].main&&("light rain"===e.weather[0].description||"moderate rain"===e.weather[0].description||"light intensity shower rain"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/lightRain.png":"shower rain"===e.weather[0].description||"ragged shower rain"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/rains.png":"heavy intensity rain"===e.weather[0].description||"freezing rain"===e.weather[0].description||"heavy intensity shower rain"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/cloudRainDeg.png":"very heavy rain"!==e.weather[0].description&&"extreme rain"!==e.weather[0].description||(weatherElems.currentWeatherIcon.src="../img/icons/cloud2rain.png")),"Drizzle"===e.weather[0].main&&(weatherElems.currentWeatherIcon.src="../img/icons/cloud90.png"),"Thunderstorm"===e.weather[0].main&&("thunderstorm with light rain"===e.weather[0].description||"thunderstorm with light drizzle"===e.weather[0].description||"thunderstorm with drizzle"===e.weather[0].description||"thunderstorm with heavy drizzle"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/drizzleThunder.png":"thunderstorm with rain"===e.weather[0].description||"thunderstorm with heavy rain"===e.weather[0].description||"heavy thunderstorm"===e.weather[0].description?weatherElems.currentWeatherIcon.src="../img/icons/cloudrainthunder.png":"thunderstorm"!==e.weather[0].description&&"light thunderstorm"!==e.weather[0].description&&"ragged thunderstorm"!==e.weather[0].description||(weatherElems.currentWeatherIcon.src="../img/icons/cloudTh.png")),weatherElems.feelsLikeEl.textContent=`${Math.round(e.main.feels_like-273)}`,weatherElems.windEl.textContent=`${Math.round(e.wind.speed)} `,weatherElems.humidity.textContent=`${Math.round(e.main.humidity)}`,mapMarker&&(map.removeLayer(mapMarker),map.removeLayer(mapCircle)),mapMarker=L.marker([e.coord.lat,e.coord.lon]).addTo(map),mapCircle=L.circle([e.coord.lat,e.coord.lon],{radius:1e4}).addTo(map),map.fitBounds(mapCircle.getBounds()),document.querySelector("[data-coords-lat]").textContent=`${e.coord.lat}`,document.querySelector("[data-coords-lon]").textContent=`${e.coord.lon}`,fetch(`https://api.weatherapi.com/v1/forecast.json?key=76c3cf13dc02402cacd153833232809&q=${e.name}&days=4&aqi=no&alerts=no`).then((e=>e.json())).then((e=>{console.log(e);const t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday","Monday","Tuesday"];"C"===selectedUnits&&(weatherElems.firstDay.firstDayOfWeekDegreeEl.textContent=e.forecast.forecastday[1].day.avgtemp_c.toFixed(),weatherElems.secondDay.secondDayOfWeekDegreeEl.textContent=e.forecast.forecastday[2].day.avgtemp_c.toFixed(),weatherElems.thirdDay.thirdDayOfWeekDegreeEl.textContent=e.forecast.forecastday[3].day.avgtemp_c.toFixed()),"F"===selectedUnits&&(weatherElems.firstDay.firstDayOfWeekDegreeEl.textContent=e.forecast.forecastday[1].day.avgtemp_f.toFixed(),weatherElems.secondDay.secondDayOfWeekDegreeEl.textContent=e.forecast.forecastday[2].day.avgtemp_f.toFixed(),weatherElems.thirdDay.thirdDayOfWeekDegreeEl.textContent=e.forecast.forecastday[3].day.avgtemp_f.toFixed()),weatherElems.firstDay.firstDayOfWeekEl.textContent=t[DateClass.getDay()+1],weatherElems.secondDay.secondDayOfWeekEl.textContent=t[DateClass.getDay()+2],weatherElems.thirdDay.thirdDayOfWeekEl.textContent=t[DateClass.getDay()+3];let r=[];fetch("https://www.weatherapi.com/docs/weather_conditions.json").then((e=>e.json())).then((function(t){r=t.map((({day:e,night:t})=>e===t?e:t)),r.push("Sunny");const a=[weatherElems.firstDay.firstDayOfWeekIcon,weatherElems.secondDay.secondDayOfWeekIcon,weatherElems.thirdDay.thirdDayOfWeekIcon];let n=0;a.map((t=>{n+=1;let a=e.forecast.forecastday[n].day.maxwind_kph;a=a%3.6==0?(a/3.6).toFixed():(a/3.6).toFixed(1),weatherElems.forecastBlocksRefs[n-1].innerHTML=`<h4 class="forecast-card__subtitle">${e.forecast.forecastday[n].day.condition.text}</h4>\n                  <p class="forecast__desc">wind: ${a} m/s</p>\n                  <p class="forecast__desc">rain: ${e.forecast.forecastday[n].day.daily_chance_of_rain}%</p>`,r.map((r=>{if(e.forecast.forecastday[n].day.condition.text===r)switch(e.forecast.forecastday[n].day.condition.text){case"Sunny":t.src="../img/icons/sun.png";break;case"Clear":t.src="../img/icons/moon.png";break;case"Partly cloudy":t.src="../img/icons/cloudsSunD.png";break;case"Cloudy":case"Overcast":t.src="../img/icons/twoclouds.png";break;case e.forecast.forecastday[n].day.maxwind_kph>25:t.src="../img/icons/cloudwind.png";break;case"Mist":t.src="../img/icons/cloudFog.png";break;case"Patchy rain possible":case"Patchy light drizzle":case"Light drizzle":case"Freezing drizzle":case"Patchy light rain":case"Light rain":t.src="../img/icons/lightRain.png";break;case"Patchy snow possible":case"Patchy heavy snow":t.src="../img/icons/cloud1snow.png";break;case"Patchy sleet possible":t.src="../img/icons/cloud90.png";break;case"Thundery outbreaks possible":t.src="../img/icons/lightning.png";break;case"Blizzard":t.src="../img/icons/cloudwind.png";break;case"Heavy freezing drizzle":case"Moderate rain":t.src="../img/icons/rains.png";break;case"Heavy rain at times":t.src="../img/icons/cloudRainDeg.png";break;case"Heavy rain":t.src="../img/icons/cloud2rain.png";break;case"Moderate or heavy sleet":t.src="../img/icons/cloudsnow.png";break;case"Patchy light snow":t.src="../img/icons/snow.png";break;case"Moderate snow":t.src="../img/icons/snows.png";break;case"Light rain shower":t.src="../img/icons/cloudrain90.png";break;case"Patchy light rain with thunder":t.src="../img/icons/cloudTh.png";break;case"Moderate or heavy rain with thunder":t.src="../img/icons/cloudrainthunder.png";break;case"Patchy light snow with thunder":t.src="../img/icons/drizzleThunder.png"}}))}))}))}))})).catch((function(e){console.log(e),errorTextEl.classList.remove("error-hidden"),errorTextEl.textContent="City not found"}))}localStorage.getItem("cityValue")&&(formEl.cityInput.value=localStorage.getItem("cityValue")),formEl.addEventListener("submit",(function(e){e.preventDefault(),errors=0,errorTextEl.classList.add("error-hidden"),errorTextEl.textContent="",""===this.cityInput.value?(errors+=1,errorTextEl.textContent="The field is empty",errorTextEl.classList.remove("error-hidden")):this.cityInput.value.length<3||this.cityInput.value.length>25?(errors+=1,""===errorTextEl.textContent&&(errorTextEl.textContent="Type a valid city"),errorTextEl.classList.remove("error-hidden")):0===errors&&weatherFetch.call(this)}));